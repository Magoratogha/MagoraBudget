<form [formGroup]="form" class="d-flex flex-column w-100 align-items-center justify-content-center">
  <h1 class="text-center">Transacción</h1>

  <mat-button-toggle-group formControlName="type" hideSingleSelectionIndicator class="mb-4 mt-2">
    @for (type of Object.keys(TransactionType); track type) {
      @if (!isNaN(Number(type))) {
        <mat-button-toggle [value]="Number(type)">
          <mat-icon class="material-symbols-rounded">{{ getTransactionTypeIcon(Number(type)) }}</mat-icon>
          {{ getTransactionTypeLabel(Number(type)) }}
        </mat-button-toggle>
      }
    }
  </mat-button-toggle-group>

  <app-money-input class="mb-3" formControlName="amount"/>
  <app-date-picker class="mb-4" formControlName="date"/>

  @if (availableOriginAccounts().length && availableTargetAccounts().length) {
    <div class="inputs-wrapper w-100">
      <mat-form-field floatLabel="auto">
        <mat-label>Cuenta</mat-label>
        <mat-select formControlName="originAccountId">
          <mat-option>--</mat-option>
          @for (account of availableOriginAccounts(); track account.id) {
            <mat-option [value]="account.id">
              <mat-icon class="material-symbols-rounded">{{ getAccountTypeIcon(account.type) }}</mat-icon>
              {{ account.label }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>

      @if (selectedTransactionType() === TransactionType.Transfer) {
        <mat-form-field floatLabel="auto">
          <mat-label>A la cuenta</mat-label>
          <mat-select formControlName="targetAccountId">
            <mat-option>--</mat-option>
            @for (account of availableTargetAccounts(); track account.id) {
              <mat-option [value]="account.id">
                <mat-icon class="material-symbols-rounded">{{ getAccountTypeIcon(account.type) }}</mat-icon>
                {{ account.label }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      }
    </div>
  } @else {
    <p class="text-center text-red">Para hacer una transacción primero debes agregar una o más cuentas.</p>
  }
</form>

<div class="d-flex flex-column gap-2 w-100 mt-4">
  <button matButton="filled" [disabled]="!form.valid" (click)="save()">Guardar</button>
  @if (transaction()?.id) {
    <button matButton="filled" class="danger-button" (click)="delete()">Eliminar</button>
  }
  <button matButton="tonal" (click)="cancel()">Cancelar</button>
</div>
